<div class="admin-section">
  <h2>ç®¡ç†è€…æ©Ÿèƒ½</h2>

  <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="tab-navigation">
    <button class="tab-button" [class.active]="activeTab === 'attendance'" (click)="switchTab('attendance')">
      ğŸ“Š å‹¤æ€ è¨˜éŒ²
    </button>
    <button class="tab-button" [class.active]="activeTab === 'users'" (click)="switchTab('users')">
      ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
    </button>
  </div>

  <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
  <div *ngIf="message" class="alert" [ngClass]="{
    'alert-success': messageType === 'success',
    'alert-error': messageType === 'error',
    'alert-info': messageType === 'info'
  }">
    {{ message }}
  </div>

  <!-- å‹¤æ€ è¨˜éŒ²ã‚¿ãƒ– -->
  <div *ngIf="activeTab === 'attendance'" class="tab-content">
    <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="search-form">
      <div class="form-row">
        <div class="form-group">
          <label for="startDate">é–‹å§‹æ—¥</label>
          <input type="date" id="startDate" [(ngModel)]="startDate" class="form-control">
        </div>
        <div class="form-group">
          <label for="endDate">çµ‚äº†æ—¥</label>
          <input type="date" id="endDate" [(ngModel)]="endDate" class="form-control">
        </div>
      </div>
      <div class="button-container">
        <button class="btn btn-search" (click)="searchRecords()">
          ğŸ” æ¤œç´¢
        </button>
        <button class="btn btn-export" (click)="exportExcel()">
          ğŸ“¥ Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        </button>
      </div>
    </div>

    <!-- å‹¤æ€ è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <div class="table-container" *ngIf="records.length > 0">
      <table>
        <thead>
          <tr>
            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</th>
            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
            <th>æ—¥ä»˜</th>
            <th>å‹¤æ€ åŒºåˆ†</th>
            <th>å‡ºå‹¤æ™‚åˆ»</th>
            <th>é€€å‹¤æ™‚åˆ»</th>
            <th>å‹¤å‹™æ™‚é–“</th>
            <th>çŠ¶æ…‹</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of records">
            <td>{{ record.userId }}</td>
            <td>{{ record.username }}</td>
            <td>{{ formatDate(record.recordDate) }}</td>
            <td>
              <span *ngIf="record.attendanceType === 'ANNUAL_LEAVE'" class="type-badge type-leave">å¹´ä¼‘</span>
              <span *ngIf="record.attendanceType !== 'ANNUAL_LEAVE'" class="type-badge type-work">é€šå¸¸</span>
            </td>
            <td>{{ record.attendanceType === 'ANNUAL_LEAVE' ? '-' : formatTime(record.checkInTime) }}</td>
            <td>{{ record.attendanceType === 'ANNUAL_LEAVE' ? '-' : formatTime(record.checkOutTime) }}</td>
            <td>{{ record.attendanceType === 'ANNUAL_LEAVE' ? 'å¹´ä¼‘' : calculateWorkHours(record) }}</td>
            <td>
              <span class="status-badge" [ngClass]="{
              'status-in-progress': record.status === 'IN_PROGRESS',
              'status-completed': record.status === 'COMPLETED',
              'status-leave': record.status === 'ANNUAL_LEAVE'
            }">
                {{ record.status === 'ANNUAL_LEAVE' ? 'å¹´ä¼‘' : (record.status === 'IN_PROGRESS' ? 'å‹¤å‹™ä¸­' : 'å®Œäº†') }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="no-data" *ngIf="records.length === 0">
      <p>æ¤œç´¢ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‹¤æ€ è¨˜éŒ²ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</p>
    </div>
  </div>

  <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚¿ãƒ– -->
  <div *ngIf="activeTab === 'users'" class="tab-content">
    <div class="user-management">
      <div class="user-header">
        <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h3>
        <button class="btn btn-add-user" (click)="showAddUserForm()">
          â• ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
        </button>
      </div>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ /ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
      <div *ngIf="showUserForm" class="user-form-modal">
        <div class="user-form-content">
          <h3>{{ editingUser ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†' : 'ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ' }}</h3>

          <div class="form-group">
            <label for="username">ãƒ¦ãƒ¼ã‚¶ãƒ¼å *</label>
            <input type="text" id="username" [(ngModel)]="newUser.username" class="form-control" placeholder="å±±ç”°å¤ªéƒ">
          </div>

          <div class="form-group">
            <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
            <input type="email" id="email" [(ngModel)]="newUser.email" class="form-control"
              placeholder="yamada@example.com">
          </div>

          <div class="form-group">
            <label for="role">å½¹å‰²</label>
            <select id="role" [(ngModel)]="newUser.role" class="form-control">
              <option value="EMPLOYEE">ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼</option>
              <option value="ADMIN">ç®¡ç†è€…</option>
            </select>
          </div>

          <div class="form-buttons">
            <button class="btn btn-primary" (click)="editingUser ? updateUser() : createUser()">
              {{ editingUser ? 'æ›´æ–°' : 'è¿½åŠ ' }}
            </button>
            <button class="btn btn-secondary" (click)="cancelUserForm()">
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
          </div>
        </div>
      </div>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
              <th>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</th>
              <th>å½¹å‰²</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.userId }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [ngClass]="{
                  'role-admin': user.role === 'ADMIN',
                  'role-employee': user.role === 'EMPLOYEE'
                }">
                  {{ getRoleDisplayName(user.role) }}
                </span>
              </td>
              <td class="action-buttons">
                <button class="btn btn-sm btn-edit" (click)="showEditUserForm(user)">
                  âœï¸ ç·¨é›†
                </button>
                <button class="btn btn-sm btn-delete" (click)="deleteUser(user)" [disabled]="user.role === 'ADMIN'">
                  ğŸ—‘ï¸ å‰Šé™¤
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="no-data" *ngIf="users.length === 0">
        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
      </div>
    </div>
  </div>
</div>